## OWASP Top 10 Mobile - 2016
O OWASP é uma fundação mundial com o propósito de levar aspectos de segurança a tantas pessoas quanto possível. Ela é divida em Capítulos, que são grupos regionais responsáveis pela evangelização do ponto de vista de desenvolvimento seguro, apresentando vulnerabilidades mais comuns, com destaque para as Top 10, guias de correção e plataformas de treinamento. Na Lista Top 10 Mobile 2016 são apresentadas as 10 vulnerabilidades mais comuns em aplicações móveis entre 2014 e 2016, período entre o lançamento da penúltima e última lista da fundação sobre este tema.

O Lista completa pode ser consultada em: 
	- OWASP Top 10 Mobile (2016) - https://www.owasp.org/index.php/Mobile_Top_10_2016-Top_10
	- OWASP Top 10 Mobile (2014) - https://www.owasp.org/index.php/Mobile_Security_Project_Archive#tab=Top_10_Mobile_Risks

Para este série irei utilizar o InsecureBankv2.apk, que é um aplicativo android vulnerável para desenvolvedores e entusiastas da segurança aprenderem sobre inseguranças Android. O .apk  pode ser baixado em https://github.com/dineshshetty/Android-InsecureBankv2, ou por meio do comando:
	- https://github.com/dineshshetty/Android-InsecureBankv2/blob/master/InsecureBankv2.apk


## Mobile Risks: M1 – Improper platform usage.
Uso impróprio da plataforma abrange principalmente o uso indevido dos recursos da plataforma ou a falha no uso dos controles de segurança da plataforma fornecidos e documentados pela plataforma e pela comunidade.

Em aplicativos baseados no Android, o arquivo AndroidManifest.xml é uma boa fonte de informação sobre a configuração da plataforma e de como o aplicativo deve se comportar, por isso, é nele por onde vamos começar a procurar erros de configuração de segurança envolvendo o uso impróprio da plataforma.

Então vamos lá...

- Primeiro vamos usar o apktool para fazer a decodificação/engenharia reversa do .apk na pasta insecure-bankv2.
	- $ apktool d InsecureBankv2.apk -o insecure-bankv2

- Dentro do diretório insecure-bankv2 é possível ver que a ferramentas gerou diversos arquivos referentes a aplicação, inclusive o AndroidManifest.xml.
	- $ cd insecure-bankv2
	- $ ls -la 

- Uma das primeiras coisas que você deve verificar no AndroidManifest.xml são subtags da tag <application>, aqui você encontrará os componentes definidos para esta aplicação, são eles: 
	- <activity>
	- <receiver>
	- <provider>
Cada um de um com funcionalidade e características próprias. Em geral, se você vir vários componentes com a tag <exported>  configurado como "true", isso provavelmente será um sinal de configuração incorreta e uso incorreto da plataforma. Aqui, é importante ressaltar que, mesmo que um componente não tenha a tag <exported>, se um <intent-filter> for definido dentro do componente, o <exported> será definido como "true" por padrão.


- No caso do aplicativo que estamos testando vamos encontrar algumas situações como as descritas acima, o que nos da vários indicios de mal uso da plataforma. No entanto, antes de fazer afirmações fortes, cada componente deve ser revisado e analisado para entender para o que eles estão usando estes exports o quais informações talvez eles estejam compartilhando com outros componentes.

- Uma ferramenta muito útil para auxiliar no processo de idenficação de como estes componentes se comportam é o Drozer Framework. Vale ressaltar que ele, assim como a maioria das ferramentas apresentas aqui são voltadas para aplicativos baseados em Android. Então agora vamos configurar o Drozer. No Android Tamer o drozer já vem instalado, mas ainda precisamos baixar o agente (.apk) que será instalado no dispositivo virtual que foi criado no artigo anterior - mob0x02 (neste ponto o AVD deve estar execução, caso não esteja, inicialize-o).
Para baixar o agente do drozer execute o seguinte comando:
	- $ wget https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk
	
Tendo certeza de que o AVD está em execução, instale o .apk baixado. O adb (android debugger bridge), que também já vem instalado no Tamer, é uma ferramenta de linha de comando que permite a comunicação com uma instância de emulador ou com um dispositivo Android conectado, disponibilizada pelo próprio Google. 
Liste os AVDs em execução e certifique-se de ter apenas um:
	- $ adb devices

O .apk será instalado no AVD disponível. O comando abaixo é válido para a instalação de qualquer .apk no emulador. Depois de instalado.
	- $ adb install drozer-agent-2.3.4.apk

Abra o drozer-agent no AVD e inicie o serviço.
	- clique em OFF (ele ficará ON)

Para nos comunicarmos com o drozer precisamos estabelecer alguma rota de comunicação com ele. Na parte inferior do emuladore, com o drozer-agent aberto, deverá mostrar que ele roda na porta 31415, caso não seja, não se preocupe, mude o número da porta no comando abaixo para a porta que aparece no seu emulador.
	- $ adb forward tcp:31415 tcp:31415

Verifique se a conexão está LISTEN na porta 31415 e inicie o drozer console.
	- $ netstat -tupan | grep 31415
	- $ drozer console connect


Agora que temos um console de comunicação aberto com o emulador por meio do drozer, vamos começar o processo de verificação do uso potencial iso impróprio do framework neste .apk.

Em um outro terminal, instale o .apk da aplicação que esta sendo testada e execute ela no emulador para ver como se comporta. Lembrando que neste caso estamos tratando do aplicativo InsecureBankv2.apk.
	- $ adb install InsecureBankv2.apk




run app.package.list -f <app-name>

run app.package.info -a com.android.<app-name>

run app.package.attacksurface com.android.<app-name>

run app.activity.info -a com.android.<app-name>

run app.activity.start --component com.android.<app-name> com.android.<app-name>.<component>













## Referências
- https://hub.hacken.io/blog/implementation-of-the-owasp-mobile-top-10-methodology-for-testing-android-applications
